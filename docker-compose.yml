services:
  # ==========================================
  # Nerfstudio (splatfacto, nerfactoç­‰) + Web UI
  # ==========================================
  nerfstudio:
    build: containers/nerfstudio
    container_name: nerfstudio
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: all
              capabilities: [ gpu ]
    volumes:
      - .:/workspace
      - ./data:/workspace/data
      - ./outputs:/workspace/outputs
      - ./exports:/workspace/exports
      # Docker socket for controlling sibling containers from Web UI
      - //var/run/docker.sock:/var/run/docker.sock
    ports:
      - "7007:7007"
      - "8501:8501"
    stdin_open: true
    tty: true
    shm_size: "12gb"

  # ==========================================
  # SuGaR (Mesh Extraction from 3DGS)
  # ==========================================
  sugar:
    build: containers/sugar
    container_name: sugar
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: all
              capabilities: [ gpu ]
    volumes:
      - ./data:/workspace/data
      - ./outputs:/workspace/outputs
      - ./exports:/workspace/exports
      - ./scripts:/workspace/scripts
    stdin_open: true
    tty: true
    shm_size: "12gb"
    profiles:
      - sugar
      - all

  # ==========================================
  # 2DGS (2D Gaussian Splatting)
  # ==========================================
  2dgs:
    build: containers/2dgs
    container_name: 2dgs
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: all
              capabilities: [ gpu ]
    volumes:
      - ./data:/workspace/data
      - ./outputs:/workspace/outputs
      - ./exports:/workspace/exports
      - ./scripts:/workspace/scripts
    stdin_open: true
    tty: true
    shm_size: "12gb"
    profiles:
      - 2dgs
      - all
